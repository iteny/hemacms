<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Menu site</title>
    <link rel="stylesheet" type="text/css" href="/static/common/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/static/common/easyui/themes/bootstrap/easyui.css">
    <link rel="stylesheet" type="text/css" href="/static/common/easyui/themes/IconExtension.css">
    <link rel="stylesheet" href="/static/common/pnotify/pnotify.custom.min.css" media="all" type="text/css" />
    <link rel="stylesheet" type="text/css" href="/static/admin/css/admin.css">
    <style>
    .datagrid-view{
        margin-top: 0;
    }
    </style>
</head>
<body style="margin:0;padding:0;">
    <form id="hm-app" action="/intendant/site/sortMenu" method="post">
        <div class="easyui-layout" style="padding:10px 0px 60px 10px;">
            <table id="hm_menu" style="" region="center"></table>
        </div>
        <div id="hm_toolbar">
            <a href="javascript:void(0)" onclick="hm.ajaxSort(menuSort,this)" class="easyui-linkbutton" iconCls="icon-arrow_ns" plain="true">[[$store.state.language.sort]]</a>
            <a href="javascript:void(0)" onclick="hm.getVerify(this)" data-url="/intendant/site/addMenu/0" class="easyui-linkbutton" iconCls="icon-add" plain="true">[[$store.state.language.addTopMenu]]</a>
            <a href="javascript:void(0)" onclick="hm.datagridReload('#hm_menu','treegrid')" class="easyui-linkbutton" iconCls="icon-2013040601125064_easyicon_net_16" plain="true">[[$store.state.language.reloadDatagrid]]</a>
        </div>
        <!-- <div id="hm_menu_tools">
            <div>
                <a href="/intendant/site/addMenu/0" class="easyui-linkbutton" iconCls="icon-add" plain="true">[[$store.state.language.addTopMenu]]</a>
            </div>
            <div>
                Date From: <input name="iteny" value="iteny" class="easyui-datebox" style="width:80px"> To: <input class="easyui-datebox" style="width:80px"> Language:
                <select class="easyui-combobox" panelHeight="auto" style="width:100px">
    				<option value="java">Java</option>
    				<option value="c">C</option>
    				<option value="basic">Basic</option>
    				<option value="perl">Perl</option>
    				<option value="python">Python</option>
    			</select>
                <a href="#" class="easyui-linkbutton" iconCls="icon-search">Search</a>
            </div>
        </div> -->
    </form>

</body>
<script type="text/javascript" src="/static/common/easyui/jquery.min.js"></script>
<script type="text/javascript" src="/static/common/easyui/jquery.cookie.js"></script>
<script type="text/javascript" src="/static/common/easyui/jquery.easyui.min.js"></script>
<script type="text/javascript" src="/static/common/pnotify/pnotify.custom.min.js"></script>
<link rel="stylesheet" href="/static/common/animate/animate.min.css">
<script type="text/javascript" src="/static/admin/js/language.js"></script>
<script type="text/javascript" src="/static/admin/js/global.js"></script>
<script type="text/javascript" src="/static/common/dist/hmcms-vue.js"></script>
<script type="text/javascript">
parent.hm.openProgress();
var mehigh = document.documentElement.clientHeight-80;
$('#hm_menu').treegrid({
    height: mehigh,
    nowrap: true,
    emptyMsg: 'no records found',
    url: '/intendant/site/getMenu',
    idField: 'id',
    treeField: 'text',
    fitColumns: true, //宽度自适应窗口
    rownumbers: false, //是否加行号
    singleSelect: true,
    scrollbarSize: 0, //去除滚动条，否则右边最后一列会自动多处一块
    toolbar: '#hm_menu_tools',
    columns: [
        [{
                field: 'sort',
                title: hm.language.sort ? hm.language.sort : 'Sort',
                width: 30,
                align: 'center',
                formatter: function(value, row, index) {
                    return '<input name="' + row.id + '" value="' + value + '" class="easyui-validatebox" style="width:30px;text-align:center;border-radius:4px;"';
                }
            },{
                field: 'id',
                title: 'ID',
                width: 20,
                align: 'center',
            },
            {
                field: 'text',
                title: hm.language.menuName ? hm.language.menuName : 'Menu name',
                width: 120,
                align: 'left',
                formatter: function(value, row, index) {
                    var lang = '';
                    switch ($.cookie('back-language')) {
                        case 'cn':
                            lang = value;
                            break;
                        case 'en':
                            lang = row.en;
                            break;
                        default:
                            lang = value;
                    }
                    return lang;
                }
            },
            {
                field: 'url',
                title: hm.language.menuUrl ? hm.language.menuUrl : 'Menu url',
                width: 120,
                align: 'center',
            },
            {
                field: 'isshow',
                title: hm.language.isshow ? hm.language.isshow : 'isshow',
                width: 30,
                align: 'center',
                formatter: function(value, row, index) {
                    if(value){
                        return '<i class="fa fa-check" style="color:white;background-color:green;border-radius:25px;padding:2px;"></i>';
                    }else{
                        return '<i class="fa fa-close" style="color:white;background-color:red;border-radius:25px;padding:2px;width:15px;"></i>';
                    }
                }
            },
            {
                field: 'cz',
                title: hm.language.manageOperat ? hm.language.manageOperat : 'Management operation',
                width: 180,
                align: 'center',
                formatter: function(value, row, index) {
                    if(row.level > 3){
                        str = '<a href="javascript:void(0)" class="easyui-linkbutton hm-op-btn hm-blue" iconCls="icon-add" onclick="disClick()" disabled>'+hm.language.addSubMenu+'</a>';
                    }else{
                        str = '<a href="javascript:void(0)" onclick="hm.getVerify(this)" data-url="/intendant/site/addMenu/' + row.id + '" class="easyui-linkbutton hm-op-btn hm-blue" iconCls="icon-add">'+hm.language.addSubMenu+'</a>';
                    }
                    str += '<a href="javascript:void(0)" onclick="hm.getVerify(this)" data-url="/intendant/site/editMenu/' + row.id + '" class="easyui-linkbutton hm-op-btn hm-blue" iconCls="icon-bookmark_edit">'+hm.language.ajaxEdit+'</a>';
                    str += '<a href="javascript:void(0)" onclick="hm.ajaxDel(menuDel,this)" class="easyui-linkbutton hm-op-btn hm-red" iconCls="icon-delete" data-url="/intendant/site/delMenuSubmit" data-id="' + row.id + '">'+hm.language.ajaxDel+'</a>';
                    return str;
                }
            }
        ]
    ],
    onLoadSuccess: function(data) {
        $('.easyui-validatebox').validatebox({
            required: true,
            validType: 'sort',
        });
        $('.easyui-linkbutton').linkbutton();
        parent.hm.closeProgress();
    }
});
hm.datagridWidthResize("#hm_menu",'treegrid'); //让treegrid宽度自动适应
function disClick(){//菜单不能超过3级
    hm.notice('warn',hm.language.menuLevelConfine ? hm.language.menuLevelConfine : "Sorry,Do not allow the menu more than three!");
    return false;
}
function menuSort(data){
    var failed = hm.language.menuSortInfoFailed ? hm.language.menuSortInfoFailed : "Menu sort failed!",
        success = hm.language.menuSortInfoSuccess ? hm.language.menuSortInfoSuccess : "Menu sort successed!",
        unknownError = hm.language.unknownError ? hm.language.unknownError : "Unknow error!",
        noAuth = hm.language.noAuth ? hm.language.noAuth : "You have no authority",
        idVali = hm.language.idVali ? hm.language.idVali : "Id number must be 1-8 bits positive integers!",
        sortVali = hm.language.sortVali ? hm.language.sortVali : "Sort number must be 1-8 bits positive integers!";
    if (data.status == 11) {
        parent.hm.notice("error", idVali + data.info);
    } else if (data.status == 12) {
        parent.hm.notice("error", sortVali + data.info);
    } else if (data.status == 66) {
        parent.hm.notice("error", noAuth);
    } else if(data.status == 4){
        parent.hm.notice("error", failed + data.info);
    } else if(data.status == 1){
        parent.hm.notice("success", success + data.info);
        parent.hm.refreshTab();
    }else{
        parent.hm.notice("error",unknownError+ data.info);
    }
}
function menuDel(data){
    var failed = hm.language.delFailed ? hm.language.delFailed : "Delete failed!",
        success = hm.language.delSuccess ? hm.language.delSuccess : "Delete successed!",
        unknownError = hm.language.unknownError ? hm.language.unknownError : "Unknow error!",
        noAuth = hm.language.noAuth ? hm.language.noAuth : "You have no authority",
        idVali = hm.language.idVali ? hm.language.idVali : "Id number must be 1-8 bits positive integers!";
    if (data.status == 11) {
        parent.hm.notice("error", idVali + data.info);
    } else if (data.status == 66) {
        parent.hm.notice("error", noAuth);
    } else if(data.status == 4){
        parent.hm.notice("error", failed + data.info);
    } else if(data.status == 1){
        parent.hm.notice("success", success + data.info);
        parent.hm.refreshTab();
    }else{
        parent.hm.notice("error",unknownError+ data.info);
    }
}
</script>
</html>
